#! node
const parser = require('minimist');
const { ent, Ent } = require('../index');

(async ()=>{
    let aliases = {}, defaults = {};
    Object.entries(Ent.flagConfig).forEach(entry => {
        if(entry){
            const [ key, val ] = entry;
            const { alias, initial } = val;
            if(alias) aliases[alias] = key;
            if(initial) defaults[key] = initial;
        }
    })
    
    try{
        // parse flags
        const opts = parser(process.argv.slice(2), {
            alias: aliases, 
            default: defaults
        });
        opts.interactive = true; // always true from CLI
        // get first positional arg (top-level cmd)
        let cmd = opts._;
        cmd = ent[cmd];
        
        // call the command with the provided flags (args)
        delete opts._;
        await ent(opts, cmd);
    } catch(err){
        console.error(err.message);
    }
})();